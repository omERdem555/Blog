---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { POSTS_PER_PAGE } from "../config/pagination";

const allPosts = await getCollection("blog", ({ data }) => {
  return data.draft === false;
});

allPosts.sort((a, b) =>
  b.data.publishDate.getTime() - a.data.publishDate.getTime()
);

const posts = allPosts.slice(0, POSTS_PER_PAGE);
const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
---

<BaseLayout
  title="Blog"
  description="Kişisel ve teknik yazılar"
  type="website"
>
  <h1>Blog</h1>

  <ul>
    {posts.map((post) => (
      <li>
        <a href={`/blog/${post.slug}/`}>
          {post.data.title}
        </a>
        <p>{post.data.description}</p>
      </li>
    ))}
  </ul>

  {totalPages > 1 && (
    <nav>
      <a href="/page/2/">Next →</a>
    </nav>
  )}
</BaseLayout>