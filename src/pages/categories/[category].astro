---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { sortPostsByDateDesc } from "../../lib/sort";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft);

  const categories = [...new Set(posts.map(p => p.data.category))];

  return categories.map(category => ({
    params: { category }
  }));
}

const { category } = Astro.params;

// Draft olmayan ve ilgili kategoriye ait postları al
let posts = await getCollection("blog", ({ data }) =>
  !data.draft && data.category === category
);

// Global sort kullan
posts = sortPostsByDateDesc(posts);
---

<BaseLayout title={`Kategori: ${category}`}>

  <main class="container">

    <!-- Hero Section -->
    <section class="hero">
      <h1 class="hero-title">
        {category}
      </h1>
      <p class="hero-subtitle">
        "{category}" kategorisindeki yazılar
      </p>
    </section>

    <!-- Post Grid -->
    <section class="post-grid">
      {posts.map(post => (
        <article class="post-card">
          <h2>
            <a href={`/blog/${post.slug}/`}>
              {post.data.title}
            </a>
          </h2>
          <p>{post.data.description}</p>

          {post.data.publishDate && (
            <small class="post-date">
              {post.data.publishDate.toLocaleDateString("tr-TR")}
            </small>
          )}
        </article>
      ))}
    </section>

  </main>

</BaseLayout>